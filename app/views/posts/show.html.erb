<div class="container mt-5">
  <div class="row">
    <!-- Colonne pour l'article -->
    <div class="col-md-12">
      <div class="card mb-5" style="background-color: #f0fff4;">
        <div class="card-body">
          <% if @post.photos.any? %>
            <%= cl_image_tag @post.photos.first.key, alt: @post.titre, style: "height: 300px; width: 100%; object-fit: cover; border-radius:10px;" %>
          <% end %>
          <h1 class="card-title mt-1"><%= @post.titre %></h1>
          <h5 class="card-subtitle mb-2 text-muted"><%= @post.categorie %></h5>
          <p class="card-text"><small class="text-muted"><%= @post.date_publication %></small></p>
          <p class="card-text"><%= @post.contenu %></p>
          <div class="d-flex justify-content-end">
            <%= link_to 'Retour', posts_path, class: 'btn btn-success text-white rounded-pill' %>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <!-- Section pour les commentaires -->
    <div class="col-md-12">
      <% if @post.comments.present? %>
        <% @post.comments.each do |comment| %>
          <div class="card mb-3 p-3" style="background-color: #f0fff4;" id="comment-<%= comment.id %>">
            <div class="card-body">
              <div class="comment-content">
                <div>
                  <strong>Par <%= comment.user.prenom %> <%= comment.user.nom %> :</strong>
                </div>
                <p class="text-decoration-underline fst-italic"><%= comment.titre %></p>
                <p><%= comment.contenu %></p>
                <% if comment.user == current_user %>
                  <div class="d-flex justify-content-end">
                    <button class="btn btn-warning text-white rounded-pill mr-2 edit-comment-btn" data-comment-id="<%= comment.id %>">Modifier</button>
                    <%= link_to 'Supprimer', comment_path(comment), data: { turbo_method: :delete, confirm: "Êtes vous sur ?" }, class: 'btn btn-success text-white rounded-pill' %>
                  </div>
                <% end %>
              </div>
              <div class="comment-edit-form d-none">
                <%= simple_form_for [@post, comment], url: update_comment_post_comment_path(@post, comment), method: :patch, html: { class: 'edit-comment-form' } do |f| %>
                  <%= f.input :titre, input_html: { value: comment.titre } %>
                  <%= f.input :contenu, input_html: { value: comment.contenu } %>
                  <div class="d-flex justify-content-end">
                    <%= f.submit "Mettre à jour", class: 'btn btn-secondary text-white rounded-pill mx-auto' %>
                  </div>
                <% end %>
              </div>
            </div>
          </div>
        <% end %>
      <% else %>
        <p class="fst-italic p-3 d-flex flex-column align-items-center justify-content-center rounded mb-3" style="background-color: #f0fff4;">Aucun commentaire pour le moment.</p>
      <% end %>
    </div>
  </div>

  <!-- Section pour ajouter un commentaire -->
  <div class="row mt-4">
    <div class="col-md-12">
      <div class="card mb-5 p-3" style="background-color: #f0fff4;">
        <div class="card-body">
          <h2>Ajouter un Commentaire</h2>
          <%= simple_form_for [@post, Comment.new], html: { id: 'new-comment-form', data: { controller: "alert",
        alert_icon_value: "success",
        alert_title_value: "Commentaire ajouter avec succès",
        confirm_button_text: "All good!",
        show_cancel_button: true,
        action: "submit->alert#initSweetalert",
        turbo: false} } do |f| %>
            <%= f.input :titre, placeholder: "Votre titre" %>
            <%= f.input :contenu, placeholder: "Votre commentaire" %>
            <div class="d-flex justify-content-end">
              <%= f.submit "Soumettre", class: 'btn btn-success text-white rounded-pill' %>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
